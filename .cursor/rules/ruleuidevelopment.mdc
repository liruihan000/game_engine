---
alwaysApply: true
---
## æ·»åŠ æ–°UIç»„ä»¶éœ€è¦æ›´æ–°çš„ä½ç½®

åŸºäºä»£ç åˆ†æï¼Œè¦æ·»åŠ ä¸€ä¸ªæ–°çš„UIç»„ä»¶éœ€è¦æ›´æ–°ä»¥ä¸‹ä½ç½®ï¼š

1. ç±»å‹å®šä¹‰ (src/lib/canvas/types.ts)

// æ·»åŠ æ–°çš„æ•°æ®ç±»å‹
export interface NewComponentData {
property1: string;
property2?: boolean;
position: GamePosition;
size?: ComponentSize;
}

// æ›´æ–° ItemData è”åˆç±»å‹
export type ItemData =
| CharacterCardData
| ActionButtonData
| PhaseIndicatorData
| TextDisplayData
| NewComponentData;  // â† æ·»åŠ æ–°ç±»å‹

// æ›´æ–° CardType è”åˆç±»å‹
export type CardType =
| "character_card"
| "action_button"
| "phase_indicator"
| "text_display"
| "new_component";  // â† æ·»åŠ æ–°ç±»å‹

1. é»˜è®¤æ•°æ® (src/lib/canvas/state.ts)

export const defaultDataFor = (type: CardType): ItemData => {
switch (type) {
case "character_card": return { /* ... */ };
case "action_button": return { /* ... */ };
case "phase_indicator": return { /* ... */ };
case "text_display": return { /* ... */ };
case "new_component": return {  // â† æ·»åŠ æ–°ç»„ä»¶é»˜è®¤æ•°æ®
property1: "",
property2: false,
position: "center",
size: "medium"
};
default: return { position: "center" };
}
};

1. æ¸²æŸ“ç»„ä»¶ (src/components/canvas/CardRenderer.tsx)

// åœ¨ CardRenderer å‡½æ•°ä¸­æ·»åŠ æ–°çš„æ¸²æŸ“é€»è¾‘
if (item.type === "new_component") {
const d = item.data as NewComponentData;
const getSizeClasses = (size: string = 'medium') => {
const sizeMap: Record<string, string> = {
small: "w-30 h-20",
medium: "w-50 h-30",
large: "w-70 h-40"
};
return sizeMap[size] || sizeMap.medium;
};

```
return (
  <div className={`${getSizeClasses(d.size)} bg-card border rounded-lg p-3`}>
    {/* æ–°ç»„ä»¶çš„UIå®ç° */}
    <div>{d.property1}</div>
  </div>
);

```

}

1. Agentå·¥å…·æ³¨å†Œ (src/app/page.tsx)

useCopilotAction({
name: "createNewComponent",
description: "Create a new component for the game.",
available: "remote",
parameters: [
{ name: "name", type: "string", required: true, description: "Component name"
},
{ name: "property1", type: "string", required: true, description: "Property
description" },
{ name: "position", type: "string", required: true, description: "Grid
position" },
// ... å…¶ä»–å‚æ•°
],
handler: ({ name, property1, position, /* å…¶ä»–å‚æ•° */ }: {
name: string;
property1: string;
position: string;
// ... å…¶ä»–ç±»å‹
}) => {
const normalized = (name ?? "").trim();

```
  // é‡å¤æ€§æ£€æŸ¥
  if (normalized) {
    const existing = (viewState.items ?? initialState.items).find((it) =>
      it.type === "new_component" && (it.name ?? "").trim() === normalized
    );
    if (existing) {
      return existing.id;
    }
  }

  const data: NewComponentData = {
    property1,
    position: position as GamePosition,
    // ... å…¶ä»–å±æ€§
  };
  return addItem("new_component", name, data);
},

```

});

1. NewItemMenu (src/components/canvas/NewItemMenu.tsx)

// å¦‚æœéœ€è¦æ‰‹åŠ¨åˆ›å»ºèœå•ï¼Œæ·»åŠ æ–°é€‰é¡¹
const options: { id: CardType; label: string }[] = [
{ id: "character_card", label: "Character Card" },
{ id: "action_button", label: "Action Button" },
{ id: "phase_indicator", label: "Phase Indicator" },
{ id: "text_display", label: "Text Display" },
{ id: "new_component", label: "New Component" },  // â† æ·»åŠ 
];

ğŸ¯ æ€»ç»“

å¿…é¡»æ›´æ–°çš„æ ¸å¿ƒä½ç½® (4ä¸ª):

1. ç±»å‹å®šä¹‰ - types.ts
2. é»˜è®¤æ•°æ® - state.ts
3. æ¸²æŸ“ç»„ä»¶ - CardRenderer.tsx
4. Agentå·¥å…· - page.tsx (useCopilotAction)

å¯é€‰æ›´æ–°çš„ä½ç½® (2ä¸ª):
5. åˆ›å»ºèœå• - NewItemMenu.tsx

1. Agentæ–‡ä»¶ (agent/agent_no_loop.py)

FRONTEND_TOOL_ALLOWLIST = set([
# Game component creation tools
"createCharacterCard",
"createActionButton",
"createPhaseIndicator",
"createTextDisplay",
"createNewComponent",  # â† æ·»åŠ æ–°å·¥å…·
# Component management tools
"deleteItem"
])
declaration:
  description: Conversational party game where each turn one player shares three statements
    (two true, one false). Others discuss naturally and vote on the lie; points for
    correct guesses and successful deception. Game ends after each player has been
    the speaker for the agreed number of rounds.
  is_multiplayer: true
  min_players: 3
  player_states:
    name:
      type: string
      example: Alex
      description: Player display name.
    score:
      type: num
      example: 0
      description: Total points accumulated across rounds.
    is_speaker:
      type: boolean
      example: false
      description: Whether this player is the current speaker; controls visibility
        of statement/reveal UI.
    can_vote:
      type: boolean
      example: true
      description: Whether this player can vote this round (speakers typically cannot).
    statements:
      type: dict
      example:
        '1': I have swum with dolphins.
        '2': I speak four languages.
        '3': I have never broken a bone.
      description: The three statements provided by the speaker for the current turn.
        Private to the speaker until revealed.
    lie_index:
      type: num
      example: 2
      description: Which statement number (1-3) is the lie for the current speaker's
        turn. Hidden from non-speakers until reveal.
    statements_revealed:
      type: boolean
      example: false
      description: Whether the truth/lie reveal has been made public.
    voted_choice:
      type: num
      example: 0
      description: The statement number (1-3) this player voted as the lie this round.
        0 indicates no vote recorded.
    votes_cast_this_round:
      type: boolean
      example: false
      description: Has the player already cast a vote this round.
    rounds_as_speaker_completed:
      type: num
      example: 0
      description: How many times this player has completed a speaker turn.
    rounds_goal:
      type: num
      example: 1
      description: Agreed number of speaker turns each player should take before game
        end.
  player_states_template:
    player_states:
      1:
        name: ''
        score: 0
        is_speaker: false
        can_vote: true
        statements: {}
        lie_index: 0
        statements_revealed: false
        voted_choice: 0
        votes_cast_this_round: false
        rounds_as_speaker_completed: 0
        rounds_goal: 1
  players_example:
    player_states:
      1:
        name: Avery
        score: 0
        is_speaker: true
        can_vote: false
        statements:
          '1': I once met a famous actor at an airport.
          '2': I can speak four languages.
          '3': I have never broken a bone.
        lie_index: 2
        statements_revealed: false
        voted_choice: 0
        votes_cast_this_round: false
        rounds_as_speaker_completed: 0
        rounds_goal: 1
      2:
        name: Blake
        score: 0
        is_speaker: false
        can_vote: true
        statements: {}
        lie_index: 0
        statements_revealed: false
        voted_choice: 0
        votes_cast_this_round: false
        rounds_as_speaker_completed: 0
        rounds_goal: 1
      3:
        name: Casey
        score: 0
        is_speaker: false
        can_vote: true
        statements: {}
        lie_index: 0
        statements_revealed: false
        voted_choice: 0
        votes_cast_this_round: false
        rounds_as_speaker_completed: 0
        rounds_goal: 1
      4:
        name: Drew
        score: 0
        is_speaker: false
        can_vote: true
        statements: {}
        lie_index: 0
        statements_revealed: false
        voted_choice: 0
        votes_cast_this_round: false
        rounds_as_speaker_completed: 0
        rounds_goal: 1
    tools:
    - chat
  audience_groups:
    speaker:
      description: The current speaker whose statements are under discussion.
      selection_criteria: player.is_speaker == true
    eligible_voters:
      description: Players allowed to vote this round (typically all non-speakers).
      selection_criteria: player.can_vote == true and player.is_speaker == false
    non_speakers:
      description: All players who are not the current speaker.
      selection_criteria: player.is_speaker == false
phases:
  0:
    name: Game Introduction
    description: Introduce rules, flow, and setup; initialize shared UI including
      scoreboard. Explain that each round one player is the speaker, provides three
      statements privately, others discuss and vote on the lie, and points are awarded
      for correct guesses and successful deception until everyone meets their rounds_goal.
    actions:
    - description: Clear previous UI and set up global intro with public phase indicator
        and rules; initialize public scoreboard for tracking points
      tools:
      - clearCanvas
      - setGlobalTitle
      - setGlobalDescription
      - createPhaseIndicator
      - createTextDisplay
      - createScoreBoard
    - description: Create public text showing player count requirements and how speaker
        rotation works (is_speaker, can_vote toggling each round)
      tools:
      - createTextDisplay
    completion_criteria:
      type: UI_displayed
      description: Game introduction has been displayed to all players.
    next_phase:
      id: 1
      name: Round Setup — Speaker Handoff
  1:
    name: Round Setup — Speaker Handoff
    description: 'Confirm which player is the current speaker (set is_speaker=true
      for exactly one player, set can_vote=false for the speaker and true for all
      others, reset round fields: statements, lie_index, statements_revealed=false,
      voted_choice=0, votes_cast_this_round=false).'
    actions:
    - description: Update phase indicator for round setup and show current speaker
        to all; provide public instructions to prepare; show private prep note to
        the speaker
      tools:
      - updatePhaseIndicator
      - createTurnIndicator
      - createTextDisplay
      - createTextDisplay
    completion_criteria:
      type: UI_displayed
      description: Speaker handoff and round-state reset instructions displayed.
    next_phase:
      id: 2
      name: Statement Collection — Speaker Submits
  2:
    name: Statement Collection — Speaker Submits
    description: Speaker privately writes three statements; others wait. Collected
      text is stored in speaker.player_states.statements.
    actions:
    - description: Update phase indicator; create private text input panel for the
        speaker to submit three statements (e.g., one per line); show waiting instructions
        to non-speakers; create private preview board for the speaker
      tools:
      - updatePhaseIndicator
      - createTextInputPanel
      - createTextDisplay
      - createStatementBoard
    completion_criteria:
      type: player_action
      description: Speaker has submitted their three statements via input panel, and
        relevant player state (player_states.statements) has been updated.
      wait_for: single_player_choice
      target_players:
        description: The current speaker
        condition: player.is_speaker == true
    next_phase:
      id: 3
      name: Lie Selection — Speaker Chooses 1–3
  3:
    name: Lie Selection — Speaker Chooses 1–3
    description: Speaker privately selects which statement number (1–3) is the lie;
      others continue waiting.
    actions:
    - description: Update phase indicator; create private voting panel for the speaker
        with options ['1','2','3'] to set lie_index; show private instructions to
        the speaker and a public waiting notice to others
      tools:
      - updatePhaseIndicator
      - createVotingPanel
      - createTextDisplay
      - createTextDisplay
    completion_criteria:
      type: player_action
      description: Speaker has chosen the lie index via voting panel, and relevant
        player state (player_states.lie_index) has been updated.
      wait_for: single_player_choice
      target_players:
        description: The current speaker
        condition: player.is_speaker == true
    next_phase:
      id: 4
      name: Display Statements and Discussion
  4:
    name: Display Statements and Discussion
    description: Show the three statements to everyone without revealing the lie;
      run a discussion timer. Speaker gets a private reminder of the lie.
    actions:
    - description: Update phase indicator; create public statement board (no highlight);
        start public discussion timer; create private lie reminder card for the speaker
      tools:
      - updatePhaseIndicator
      - createStatementBoard
      - createTimer
      - createHandsCard
    completion_criteria:
      type: timer
      description: Discussion timer has expired.
    next_phase:
      id: 5
      name: Voting Phase — Guess the Lie
  5:
    name: Voting Phase — Guess the Lie
    description: All eligible voters (non-speakers with can_vote=true) vote for which
      statement is the lie (1–3).
    actions:
    - description: Update phase indicator; create voting panel visible only to eligible
        voters; show private message to the speaker indicating they cannot vote
      tools:
      - updatePhaseIndicator
      - createVotingPanel
      - createTextDisplay
    completion_criteria:
      type: player_action
      description: All eligible voters have cast their votes and relevant player states
        (player_states.voted_choice and player_states.votes_cast_this_round) have
        been updated.
      wait_for: all_players_action
      target_players:
        description: All eligible voters (non-speakers allowed to vote)
        condition: player.can_vote == true and player.is_speaker == false
    next_phase:
      id: 6
      name: Reveal Lie and Tally
  6:
    name: Reveal Lie and Tally
    description: Reveal which statement was the lie to everyone and summarize vote
      outcomes; set statements_revealed=true.
    actions:
    - description: Update phase indicator; update the public statement board to highlight
        the lie; create public result display summarizing reveal and votes
      tools:
      - updatePhaseIndicator
      - updateStatementBoard
      - createResultDisplay
    completion_criteria:
      type: UI_displayed
      description: Reveal and summary displayed publicly and statements_revealed state
        prepared for update.
    next_phase:
      id: 7
      name: Score Update and Leaderboard
  7:
    name: Score Update and Leaderboard
    description: Award points to correct guessers and to speaker if they deceived
      players; increment speaker's rounds_as_speaker_completed; refresh leaderboard.
    actions:
    - description: Update phase indicator; upsert individual player scores based on
        results; update scoreboard ordering and title; show public round summary text
      tools:
      - updatePhaseIndicator
      - upsertScoreEntry
      - updateScoreBoard
      - createTextDisplay
    completion_criteria:
      type: UI_displayed
      description: Scores updated and leaderboard refreshed.
    next_phase:
      id: 8
      name: Check Game End
  8:
    name: Check Game End
    description: Evaluate whether all players have completed the required number of
      speaker rounds (rounds_as_speaker_completed >= rounds_goal). If complete, end
      the game; otherwise hand off to the next speaker.
    actions:
    - description: Update phase indicator and display public status of round progression
        toward rounds_goal
      tools:
      - updatePhaseIndicator
      - createTextDisplay
    completion_criteria:
      type: UI_displayed
      description: Win condition evaluation finished; routing prepared.
    next_phase:
      If all players have rounds_as_speaker_completed >= rounds_goal:
        id: 99
        name: Game Over — Final Results
      Otherwise, continue with next speaker's round:
        id: 1
        name: Round Setup — Speaker Handoff
  99:
    name: Game Over — Final Results
    description: Display final standings and thank players. The scoreboard shows final
      scores in descending order.
    actions:
    - description: Clear non-essential UI and display final results summary; ensure
        scoreboard is visible and finalized
      tools:
      - clearCanvas
      - createResultDisplay
      - updateScoreBoard
    completion_criteria:
      type: UI_displayed
      description: Final results have been displayed to all players.
    next_phase: null

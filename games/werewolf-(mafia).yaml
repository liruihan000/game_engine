declaration:
  description: 'Factional social deduction game with secret night actions. Werewolves
    choose a target to eliminate, the Doctor protects a player, and the Detective
    investigates a player. Night actions resolve in order: kill attempt → protection
    check → investigation. Morning publicly reveals outcomes while private information
    (like investigation results) is disclosed only to relevant roles. The game cycles
    through role_assignment → first_night → first_morning → first_day_discussion →
    first_day_voting → repeating night/morning/day until win conditions: werewolves
    win if they equal or outnumber villagers; villagers win if all werewolves are
    eliminated.'
  is_multiplayer: true
  min_players: 4
  roles:
  - name: Villager
    description: Has no special abilities; participates in discussion and voting to
      eliminate werewolves.
  - name: Werewolf
    description: At night, collectively choose one target to eliminate; can see and
      coordinate with other werewolves.
  - name: Doctor
    description: At night, selects one player to protect from elimination.
  - name: Detective
    description: At night, investigates one player to privately learn their role or
      team alignment.
  player_states:
    name:
      type: string
      example: Player A
      description: Public display name.
    role:
      type: string
      example: Werewolf
      description: Player's hidden role; may be revealed upon elimination or by effects.
    team:
      type: string
      example: werewolves
      description: Faction affiliation for targeting and win checks (e.g., 'villagers',
        'werewolves').
    is_alive:
      type: boolean
      example: true
      description: Whether the player is still in the game. Dead players cannot act
        or vote.
    role_revealed:
      type: boolean
      example: false
      description: Whether the player's role is publicly revealed. Controls visibility
        of role information.
    can_vote:
      type: boolean
      example: true
      description: Whether the player can cast a vote during day voting.
    can_night_act:
      type: boolean
      example: false
      description: Whether the player has a night action available this night (e.g.,
        werewolf, doctor, detective).
    action_submitted:
      type: boolean
      example: false
      description: Has the player finalized their current phase action selection.
    target_player_id:
      type: num
      example: 2
      description: Selected target player ID for the current phase (0 means no target).
    last_night_status:
      type: string
      example: none
      description: 'Public morning outcome flag for this player: ''none'', ''attacked'',
        ''saved'', or ''eliminated''.'
    can_view_werewolf_chat:
      type: boolean
      example: false
      description: Whether the player has access to the werewolf coordination channel/UI.
  player_states_template:
    player_states:
      1:
        name: ''
        role: ''
        team: ''
        is_alive: true
        role_revealed: false
        can_vote: true
        can_night_act: false
        action_submitted: false
        target_player_id: 0
        last_night_status: none
        can_view_werewolf_chat: false
  players_example:
    player_states:
      1:
        name: Alpha
        role: Werewolf
        team: werewolves
        is_alive: true
        role_revealed: false
        can_vote: true
        can_night_act: true
        action_submitted: false
        target_player_id: 2
        last_night_status: none
        can_view_werewolf_chat: true
      2:
        name: Beta
        role: Villager
        team: villagers
        is_alive: true
        role_revealed: false
        can_vote: true
        can_night_act: false
        action_submitted: false
        target_player_id: 0
        last_night_status: none
        can_view_werewolf_chat: false
      3:
        name: Gamma
        role: Doctor
        team: villagers
        is_alive: true
        role_revealed: false
        can_vote: true
        can_night_act: true
        action_submitted: false
        target_player_id: 2
        last_night_status: none
        can_view_werewolf_chat: false
      4:
        name: Delta
        role: Detective
        team: villagers
        is_alive: true
        role_revealed: false
        can_vote: true
        can_night_act: true
        action_submitted: false
        target_player_id: 3
        last_night_status: none
        can_view_werewolf_chat: false
  audience_groups:
    werewolves:
      description: All alive werewolf-faction players for coordination and action
        targeting.
      selection_criteria: player.team == 'werewolves' and player.is_alive == true
    villagers:
      description: All alive villager-faction players including special roles.
      selection_criteria: player.team == 'villagers' and player.is_alive == true
    alive_players:
      description: All players still in the game.
      selection_criteria: player.is_alive == true
    eliminated_players:
      description: Players who have been removed from play.
      selection_criteria: player.is_alive == false
    voters:
      description: Players allowed to vote during day phases.
      selection_criteria: player.can_vote == true and player.is_alive == true
    night_actors:
      description: Players with a night action this turn.
      selection_criteria: player.can_night_act == true and player.is_alive == true
    doctors:
      description: Alive players with the Doctor role.
      selection_criteria: player.role == 'Doctor' and player.is_alive == true
    detectives:
      description: Alive players with the Detective role.
      selection_criteria: player.role == 'Detective' and player.is_alive == true
    werewolf_chat_access:
      description: Players who can view the werewolf coordination chat.
      selection_criteria: player.can_view_werewolf_chat == true and player.is_alive
        == true
    eligible_vote_targets:
      description: Alive players who can be targeted for elimination votes.
      selection_criteria: player.is_alive == true
phases:
  0:
    name: Game Introduction
    description: Introduce the game rules, objectives, night/day cycle, and win conditions
      to all players.
    actions:
    - description: Clear canvas and create public phase indicator for introduction
      tools:
      - clearCanvas
      - createPhaseIndicator
    - description: Display rules, objectives, and flow overview to all players
      tools:
      - createTextDisplay
    - description: Create player avatars overlay and public player states panel
      tools:
      - createAvatarSet
      - createPlayerStatesDisplay
    completion_criteria:
      type: UI_displayed
      description: Game introduction has been displayed to all players.
    next_phase:
      id: 1
      name: Role Assignment
  1:
    name: Role Assignment
    description: Randomly assign roles and privately display each player's personal
      role card.
    actions:
    - description: Create public phase indicator and announcement for role assignment
      tools:
      - createPhaseIndicator
      - createTextDisplay
    - description: Display personal role cards to each player with individual
        audience targeting
      tools:
      - createCharacterCard
    - description: Provide private role instructions per role (Werewolf, Doctor, Detective)
        and general guidance for Villagers
      tools:
      - createTextDisplay
    completion_criteria:
      type: UI_displayed
      description: Role cards have been created with proper audience permissions;
        each player can see only their own role.
    next_phase:
      id: 2
      name: Night — Werewolves Choose Target
  2:
    name: Night — Werewolves Choose Target
    description: Alive werewolves coordinate privately and select a single target
      to eliminate.
    actions:
    - description: Clear previous UI, set night atmosphere, and show public night
        phase indicator
      tools:
      - clearCanvas
      - createNightOverlay
      - createPhaseIndicator
    - description: Create private voting panel for alive werewolves to choose an alive
        target
      tools:
      - createVotingPanel
    - description: Show waiting message to all non-werewolf players
      tools:
      - createTextDisplay
    completion_criteria:
      type: player_action
      description: All alive werewolves have submitted their target choices and relevant
        player state (player_states) has been updated.
      wait_for: multiple_players_action
      target_players:
        description: All alive players with role Werewolf
        condition: player.role == 'Werewolf' and player.is_alive == true
    next_phase:
      id: 3
      name: Night — Doctor Protects
  3:
    name: Night — Doctor Protects
    description: The Doctor privately chooses a player to protect from elimination
      tonight.
    actions:
    - description: Update phase indicator for Doctor action and keep night atmosphere
      tools:
      - updatePhaseIndicator
    - description: Create private voting panel for the Doctor to choose a protection
        target
      tools:
      - createVotingPanel
    - description: Show waiting message for all other players
      tools:
      - createTextDisplay
    completion_criteria:
      type: player_action
      description: Doctor has chosen a protection target and relevant player state
        (player_states) has been updated.
      wait_for: single_player_choice
      target_players:
        description: Alive player with the Doctor role
        condition: player.role == 'Doctor' and player.is_alive == true
    next_phase:
      id: 4
      name: Night — Detective Investigates
  4:
    name: Night — Detective Investigates
    description: The Detective privately investigates one player to learn their role
      or team alignment.
    actions:
    - description: Update phase indicator for Detective action and maintain night
        setting
      tools:
      - updatePhaseIndicator
    - description: Create private voting panel for the Detective to choose an investigation
        target
      tools:
      - createVotingPanel
    - description: Show waiting message for all other players
      tools:
      - createTextDisplay
    completion_criteria:
      type: player_action
      description: Detective has chosen an investigation target and relevant player
        state (player_states) has been updated.
      wait_for: single_player_choice
      target_players:
        description: Alive player with the Detective role
        condition: player.role == 'Detective' and player.is_alive == true
    next_phase:
      id: 5
      name: Dawn — Night Outcomes Announcement
  5:
    name: Dawn — Night Outcomes Announcement
    description: Publicly announce night outcomes (attacked/saved/eliminated) and
      privately reveal investigation results to the Detective.
    actions:
    - description: Clear night UI and create public dawn phase indicator
      tools:
      - clearCanvas
      - createPhaseIndicator
    - description: Create public results display summarizing night outcomes
      tools:
      - createResultDisplay
    - description: Privately inform Detective of investigation result
      tools:
      - createTextDisplay
    completion_criteria:
      type: UI_displayed
      description: Night outcomes and private investigation result have been displayed
        to relevant audiences.
    next_phase:
      id: 6
      name: Day Discussion
  6:
    name: Day Discussion
    description: All surviving players discuss to identify a suspect; dead players
      observe only.
    actions:
    - description: Update phase indicator for daytime discussion and create discussion
        timer
      tools:
      - updatePhaseIndicator
      - createTimer
    - description: Display public discussion instructions to all players
      tools:
      - createTextDisplay
    completion_criteria:
      type: timer
      description: Discussion timer has expired.
    next_phase:
      id: 7
      name: Day Voting
  7:
    name: Day Voting
    description: All eligible surviving players vote publicly to eliminate one player.
    actions:
    - description: Update phase indicator for day voting
      tools:
      - updatePhaseIndicator
    - description: Create voting panel for all eligible voters (alive players with
        voting rights)
      tools:
      - createVotingPanel
    - description: Show status message to eliminated players that they cannot vote
      tools:
      - createTextDisplay
    completion_criteria:
      type: player_action
      description: All eligible voters have cast their votes and relevant player state
        (player_states) has been updated.
      wait_for: multiple_players_action
      target_players:
        description: All alive players who can vote
        condition: player.can_vote == true and player.is_alive == true
    next_phase:
      id: 8
      name: Announce Voting Results
  8:
    name: Announce Voting Results
    description: Reveal the player with the most votes, update public state, and mark
      them eliminated.
    actions:
    - description: Clear voting UI and create public results display with elimination
        announcement
      tools:
      - clearCanvas
      - createResultDisplay
    - description: Mark the eliminated player as dead and place a death marker
      tools:
      - markPlayerDead
      - createDeathMarker
    - description: Create public notice if the eliminated player's role is revealed
      tools:
      - createTextDisplay
    completion_criteria:
      type: UI_displayed
      description: Voting results and elimination have been announced.
    next_phase:
      id: 9
      name: Check Win Conditions
  9:
    name: Check Win Conditions
    description: Evaluate whether either side has already won; otherwise continue
      the cycle.
    actions:
    - description: Display status check message and prepare state for routing to next
        phase
      tools:
      - createTextDisplay
    completion_criteria:
      type: UI_displayed
      description: Win condition evaluation prepared; routing ready.
    next_phase:
      If no living Werewolves remain:
        id: 99
        name: Game Over — Village Wins
      If living Werewolves are equal to or outnumber living Villagers:
        id: 99
        name: Game Over — Werewolves Win
      Otherwise, continue with the next night:
        id: 2
        name: Night — Werewolves Choose Target
  99:
    name: Game Over
    description: Announce the winning faction and end the game.
    actions:
    - description: Clear UI and display final victory message
      tools:
      - clearCanvas
      - createResultDisplay
    - description: Show closing thanks/instructions to all players
      tools:
      - createTextDisplay
    completion_criteria:
      type: UI_displayed
      description: Final results have been displayed.
    next_phase: null

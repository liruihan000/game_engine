declaration:
  description: 'Social deduction game with night actions: werewolves select a target
    to eliminate, doctor chooses one player to protect, detective investigates a player''s
    alignment. Resolution order: kill attempt → protection check → investigation.
    Mornings reveal results; the game cycles through day-night states until win conditions
    are met (werewolves win when they equal/outnumber villagers; village wins when
    all werewolves are eliminated). Game Flow Navigation: role_assignment → first_night
    → first_morning → first_day_discussion → first_day_voting → (night → morning →
    day_discussion → day_voting) → game_over.'
  is_multiplayer: true
  min_players: 4
  roles:
  - name: Villager
    description: 'No night action; votes during the day. Goal: eliminate werewolves.'
  - name: Werewolf
    description: At night, coordinates to choose one target to eliminate.
  - name: Doctor
    description: At night, protects one player from elimination.
  - name: Detective
    description: At night, investigates one player to learn their alignment.
  player_states:
    name:
      type: string
      example: Player A
      description: Public display name.
    role:
      type: string
      example: Werewolf
      description: Player's hidden role (Villager, Werewolf, Doctor, Detective).
    team:
      type: string
      example: werewolves
      description: Faction alignment for targeting and win checks ('villagers' or
        'werewolves').
    is_alive:
      type: boolean
      example: true
      description: Whether the player is still in the game.
    role_revealed:
      type: boolean
      example: false
      description: Whether this player's role has been publicly revealed.
    can_vote:
      type: boolean
      example: true
      description: Whether the player is eligible to vote during day voting.
    has_secret_role:
      type: boolean
      example: true
      description: True for roles with night actions or hidden coordination (Werewolf,
        Doctor, Detective); used for secret UI panels.
    night_action_eligible:
      type: boolean
      example: true
      description: Whether the player can take a night action this night (alive Doctor,
        Detective, Werewolves).
    night_action_submitted:
      type: boolean
      example: false
      description: Whether the player has submitted their night action.
    selected_target_id:
      type: num
      example: 2
      description: Player ID selected as the target for this player's night action
        (0 if none). Used by Werewolves, Doctor, Detective.
    investigated_alignments:
      type: dict
      example:
        '2': villagers
        '3': werewolves
      description: Detective's private memory of investigation results mapping player
        IDs (as strings) to alignments; empty for other roles.
  player_states_template:
    player_states:
      1:
        name: ''
        role: ''
        team: ''
        is_alive: true
        role_revealed: false
        can_vote: true
        has_secret_role: false
        night_action_eligible: false
        night_action_submitted: false
        selected_target_id: 0
        investigated_alignments: {}
  players_example:
    player_states:
      1:
        name: Alpha
        role: Werewolf
        team: werewolves
        is_alive: true
        role_revealed: false
        can_vote: true
        has_secret_role: true
        night_action_eligible: true
        night_action_submitted: false
        selected_target_id: 2
        investigated_alignments: {}
      2:
        name: Beta
        role: Villager
        team: villagers
        is_alive: true
        role_revealed: false
        can_vote: true
        has_secret_role: false
        night_action_eligible: false
        night_action_submitted: false
        selected_target_id: 0
        investigated_alignments: {}
      3:
        name: Gamma
        role: Doctor
        team: villagers
        is_alive: true
        role_revealed: false
        can_vote: true
        has_secret_role: true
        night_action_eligible: true
        night_action_submitted: false
        selected_target_id: 2
        investigated_alignments: {}
      4:
        name: Delta
        role: Detective
        team: villagers
        is_alive: true
        role_revealed: false
        can_vote: true
        has_secret_role: true
        night_action_eligible: true
        night_action_submitted: false
        selected_target_id: 1
        investigated_alignments:
          '1': werewolves
  audience_groups:
    werewolves:
      description: Alive players aligned with the werewolf faction; used for secret
        coordination and UI.
      selection_criteria: player.team == 'werewolves' and player.is_alive == true
    villagers:
      description: Alive players aligned with the village (including Doctor and Detective).
      selection_criteria: player.team == 'villagers' and player.is_alive == true
    alive_players:
      description: All players who are alive.
      selection_criteria: player.is_alive == true
    dead_players:
      description: All players who have been eliminated.
      selection_criteria: player.is_alive == false
    special_roles:
      description: Alive players with special roles (Doctor, Detective).
      selection_criteria: player.role in ['Doctor', 'Detective'] and player.is_alive
        == true
    night_actors:
      description: Players eligible to act during the night.
      selection_criteria: player.night_action_eligible == true and player.is_alive
        == true
    voters:
      description: Players eligible to vote during day phases.
      selection_criteria: player.can_vote == true and player.is_alive == true
    secret_holders:
      description: Players who should see secret UI components.
      selection_criteria: player.has_secret_role == true and player.is_alive == true
phases:
  0:
    name: Game Introduction
    description: Introduce the game's rules, objectives, roles, and flow to all players;
      set expectations for night/day cycles and win conditions.
    actions:
    - description: Clear all previous UI elements (first phase, no exemptions needed)
      tools:
      - clearCanvas
    - description: Create public phase indicator for game introduction
      tools:
      - createPhaseIndicator
    - description: Display rules, roles overview (Werewolf, Villager, Doctor, Detective),
        night/day sequence, and win conditions to all players
      tools:
      - createTextDisplay
    - description: Create avatar set overlay for all players (public)
      tools:
      - createAvatarSet
    completion_criteria:
      type: UI_displayed
      description: Game introduction has been displayed to all players.
    next_phase:
      id: 1
      name: Role Assignment
  1:
    name: Role Assignment
    description: Randomly assign roles to players and privately display each player's
      personal role card using individual audience targeting.
    actions:
    - description: Clear introduction UI; no exemptions needed yet
      tools:
      - clearCanvas
    - description: 'TIER 1 - PUBLIC: Create phase indicator for role assignment'
      tools:
      - createPhaseIndicator
    - description: 'TIER 1 - PUBLIC: Announce that roles are being assigned and each
        player will see their personal role card privately'
      tools:
      - createTextDisplay
    - description: 'TIER 3 - INDIVIDUAL: Create personal role card for each player
        (private to the specific player) and set their night action eligibility flags
        accordingly'
      tools:
      - createCharacterCard
    completion_criteria:
      type: UI_displayed
      description: Personal role cards have been created with proper audience permissions;
        each player can see only their own role.
    next_phase:
      id: 2
      name: First Night — Werewolves Choose Target
  2:
    name: First Night — Werewolves Choose Target
    description: Alive werewolves privately choose a target to eliminate; other players
      see a waiting message.
    actions:
    - description: Clear previous UI; exempt any death markers or elimination indicators
        if present
      tools:
      - clearCanvas
    - description: 'TIER 1 - PUBLIC: Create night phase indicator (Werewolves choose
        target)'
      tools:
      - createPhaseIndicator
    - description: 'TIER 2 - GROUP: Show waiting message to all alive non-werewolf
        players'
      tools:
      - createTextDisplay
    - description: 'TIER 2 - GROUP: Create private voting panel for all alive werewolves
        to choose an alive target'
      tools:
      - createVotingPanel
    completion_criteria:
      type: player_action
      description: Votes/choices have been received from all alive werewolves, and
        relevant player state (player_states) has been updated (night_action_submitted=true,
        selected_target_id set).
      wait_for: multiple_players_action
      target_players:
        description: All alive werewolf players
        condition: player.role == 'Werewolf' and player.is_alive == true
    next_phase:
      id: 3
      name: First Night — Doctor Protects
  3:
    name: First Night — Doctor Protects
    description: The Doctor privately chooses one player to protect from elimination
      this night.
    actions:
    - description: Clear werewolf selection UI; exempt death markers and elimination
        indicators
      tools:
      - clearCanvas
    - description: 'TIER 1 - PUBLIC: Create night phase indicator (Doctor protects)'
      tools:
      - createPhaseIndicator
    - description: 'TIER 2 - GROUP: Show waiting message to all players except the
        Doctor'
      tools:
      - createTextDisplay
    - description: 'TIER 3 - INDIVIDUAL: Create private voting panel for the Doctor
        to select a protection target'
      tools:
      - createVotingPanel
    completion_criteria:
      type: player_action
      description: Doctor has submitted a protection target and relevant player state
        (player_states) has been updated (night_action_submitted=true, selected_target_id
        set).
      wait_for: single_player_choice
      target_players:
        description: Alive Doctor
        condition: player.role == 'Doctor' and player.is_alive == true
    next_phase:
      id: 4
      name: First Night — Detective Investigates
  4:
    name: First Night — Detective Investigates
    description: The Detective privately investigates one player to learn their alignment;
      result is shown only to the Detective.
    actions:
    - description: Clear doctor phase UI; exempt death markers and elimination indicators
      tools:
      - clearCanvas
    - description: 'TIER 1 - PUBLIC: Create night phase indicator (Detective investigates)'
      tools:
      - createPhaseIndicator
    - description: 'TIER 2 - GROUP: Show waiting message to all players except the
        Detective'
      tools:
      - createTextDisplay
    - description: 'TIER 3 - INDIVIDUAL: Create private voting panel for the Detective
        to select an investigation target and privately display the alignment result'
      tools:
      - createVotingPanel
    completion_criteria:
      type: player_action
      description: Detective has selected an investigation target and relevant player
        state (player_states) has been updated (night_action_submitted=true, investigated_alignments
        updated).
      wait_for: single_player_choice
      target_players:
        description: Alive Detective
        condition: player.role == 'Detective' and player.is_alive == true
    next_phase:
      id: 5
      name: First Morning — Announce Night Results
  5:
    name: First Morning — Announce Night Results
    description: 'Resolve the night: apply werewolf kill attempt versus Doctor protection,
      then announce any eliminations to all players.'
    actions:
    - description: Clear night UI; exempt death markers and elimination indicators
        so they persist
      tools:
      - clearCanvas
    - description: 'TIER 1 - PUBLIC: Create morning phase indicator and summary'
      tools:
      - createPhaseIndicator
    - description: 'TIER 1 - PUBLIC: Display result announcement showing whether someone
        was eliminated during the night'
      tools:
      - createResultDisplay
    - description: If a player was eliminated overnight, mark them dead and create
        a public death marker
      tools:
      - markPlayerDead
      - createDeathMarker
    completion_criteria:
      type: UI_displayed
      description: Night results have been announced to all players.
    next_phase:
      id: 6
      name: First Day Discussion
  6:
    name: First Day Discussion
    description: Open discussion among all players about the night events before voting.
    actions:
    - description: Clear morning announcement UI; exempt death markers and elimination
        indicators
      tools:
      - clearCanvas
    - description: 'TIER 1 - PUBLIC: Create day discussion phase indicator'
      tools:
      - createPhaseIndicator
    - description: 'TIER 1 - PUBLIC: Start a discussion timer visible to all players'
      tools:
      - createTimer
    - description: 'TIER 1 - PUBLIC: Display discussion guidelines and reminder that
        eliminated players cannot vote'
      tools:
      - createTextDisplay
    completion_criteria:
      type: timer
      description: Discussion timer has expired.
    next_phase:
      id: 7
      name: First Day Voting
  7:
    name: First Day Voting
    description: All eligible (alive) players vote to eliminate one player.
    actions:
    - description: Clear discussion UI; exempt death markers and elimination indicators
      tools:
      - clearCanvas
    - description: 'TIER 1 - PUBLIC: Create day voting phase indicator'
      tools:
      - createPhaseIndicator
    - description: 'TIER 2 - GROUP: Create voting panel for all eligible voters (alive
        players)'
      tools:
      - createVotingPanel
    - description: 'TIER 2 - GROUP: Show reminder to eliminated players that they
        cannot vote'
      tools:
      - createTextDisplay
    completion_criteria:
      type: player_action
      description: All eligible voters have cast their votes and relevant player state
        (player_states) has been updated with voting selections.
      wait_for: multiple_players_action
      target_players:
        description: All eligible voters (alive players with voting rights)
        condition: player.can_vote == true and player.is_alive == true
    next_phase:
      id: 8
      name: Announce Day Voting Results
  8:
    name: Announce Day Voting Results
    description: Announce the player selected for elimination by day vote and update
      their status.
    actions:
    - description: Clear voting UI; exempt death markers so prior eliminations remain
        visible
      tools:
      - clearCanvas
    - description: 'TIER 1 - PUBLIC: Create results display with the eliminated player''s
        name'
      tools:
      - createResultDisplay
    - description: 'TIER 1 - PUBLIC: Mark the eliminated player dead and create a
        public death marker'
      tools:
      - markPlayerDead
      - createDeathMarker
    completion_criteria:
      type: UI_displayed
      description: Day voting results have been announced and the eliminated player's
        status has been updated.
    next_phase:
      id: 9
      name: Check Win Conditions
  9:
    name: Check Win Conditions
    description: Evaluate whether either side has won after the latest elimination;
      otherwise continue the cycle.
    actions:
    - description: Prepare routing by evaluating counts of living werewolves vs living
        villagers; maintain visible death markers
      tools:
      - clearCanvas
    - description: 'TIER 1 - PUBLIC: Display brief status message while win conditions
        are evaluated'
      tools:
      - createTextDisplay
    completion_criteria:
      type: UI_displayed
      description: Win condition evaluation prepared; routing decision will be applied.
    next_phase:
      If no living Werewolves remain (all werewolves eliminated):
        id: 99
        name: Game Over — Final Results
      If living Werewolves are equal to or outnumber living Villagers:
        id: 99
        name: Game Over — Final Results
      If this check follows a day elimination and the game continues:
        id: 10
        name: Night — Werewolves Choose Target
      If this check follows a night resolution and the game continues:
        id: 14
        name: Day Discussion
  10:
    name: Night — Werewolves Choose Target
    description: Alive werewolves privately choose a target to eliminate; others wait.
    actions:
    - description: Clear previous UI; exempt death markers and elimination indicators
        for persistence
      tools:
      - clearCanvas
    - description: 'TIER 1 - PUBLIC: Create night phase indicator (Werewolves choose
        target)'
      tools:
      - createPhaseIndicator
    - description: 'TIER 2 - GROUP: Show waiting message to all alive non-werewolf
        players'
      tools:
      - createTextDisplay
    - description: 'TIER 2 - GROUP: Create private voting panel for all alive werewolves
        to choose an alive target'
      tools:
      - createVotingPanel
    completion_criteria:
      type: player_action
      description: Votes/choices have been received from all alive werewolves, and
        relevant player state (player_states) has been updated (night_action_submitted=true,
        selected_target_id set).
      wait_for: multiple_players_action
      target_players:
        description: All alive werewolf players
        condition: player.role == 'Werewolf' and player.is_alive == true
    next_phase:
      id: 11
      name: Night — Doctor Protects
  11:
    name: Night — Doctor Protects
    description: The Doctor privately chooses one player to protect from elimination
      this night.
    actions:
    - description: Clear werewolf selection UI; exempt death markers and elimination
        indicators
      tools:
      - clearCanvas
    - description: 'TIER 1 - PUBLIC: Create night phase indicator (Doctor protects)'
      tools:
      - createPhaseIndicator
    - description: 'TIER 2 - GROUP: Show waiting message to all players except the
        Doctor'
      tools:
      - createTextDisplay
    - description: 'TIER 3 - INDIVIDUAL: Create private voting panel for the Doctor
        to select a protection target'
      tools:
      - createVotingPanel
    completion_criteria:
      type: player_action
      description: Doctor has submitted a protection target and relevant player state
        (player_states) has been updated (night_action_submitted=true, selected_target_id
        set).
      wait_for: single_player_choice
      target_players:
        description: Alive Doctor
        condition: player.role == 'Doctor' and player.is_alive == true
    next_phase:
      id: 12
      name: Night — Detective Investigates
  12:
    name: Night — Detective Investigates
    description: The Detective privately investigates one player to learn their alignment;
      result is shown only to the Detective.
    actions:
    - description: Clear doctor phase UI; exempt death markers and elimination indicators
      tools:
      - clearCanvas
    - description: 'TIER 1 - PUBLIC: Create night phase indicator (Detective investigates)'
      tools:
      - createPhaseIndicator
    - description: 'TIER 2 - GROUP: Show waiting message to all players except the
        Detective'
      tools:
      - createTextDisplay
    - description: 'TIER 3 - INDIVIDUAL: Create private voting panel for the Detective
        to select an investigation target and privately display the alignment result'
      tools:
      - createVotingPanel
    completion_criteria:
      type: player_action
      description: Detective has selected an investigation target and relevant player
        state (player_states) has been updated (night_action_submitted=true, investigated_alignments
        updated).
      wait_for: single_player_choice
      target_players:
        description: Alive Detective
        condition: player.role == 'Detective' and player.is_alive == true
    next_phase:
      id: 13
      name: Morning — Announce Night Results
  13:
    name: Morning — Announce Night Results
    description: 'Resolve the night: apply werewolf kill attempt versus Doctor protection,
      then announce any eliminations to all players.'
    actions:
    - description: Clear night UI; exempt death markers and elimination indicators
        so they persist
      tools:
      - clearCanvas
    - description: 'TIER 1 - PUBLIC: Create morning phase indicator and summary'
      tools:
      - createPhaseIndicator
    - description: 'TIER 1 - PUBLIC: Display result announcement showing whether someone
        was eliminated during the night'
      tools:
      - createResultDisplay
    - description: If a player was eliminated overnight, mark them dead and create
        a public death marker
      tools:
      - markPlayerDead
      - createDeathMarker
    completion_criteria:
      type: UI_displayed
      description: Night results have been announced to all players.
    next_phase:
      id: 9
      name: Check Win Conditions
  14:
    name: Day Discussion
    description: Open discussion among all players about the night events before voting.
    actions:
    - description: Clear morning announcement UI; exempt death markers and elimination
        indicators
      tools:
      - clearCanvas
    - description: 'TIER 1 - PUBLIC: Create day discussion phase indicator'
      tools:
      - createPhaseIndicator
    - description: 'TIER 1 - PUBLIC: Start a discussion timer visible to all players'
      tools:
      - createTimer
    - description: 'TIER 1 - PUBLIC: Display discussion guidelines and reminder that
        eliminated players cannot vote'
      tools:
      - createTextDisplay
    completion_criteria:
      type: timer
      description: Discussion timer has expired.
    next_phase:
      id: 15
      name: Day Voting
  15:
    name: Day Voting
    description: All eligible (alive) players vote to eliminate one player.
    actions:
    - description: Clear discussion UI; exempt death markers and elimination indicators
      tools:
      - clearCanvas
    - description: 'TIER 1 - PUBLIC: Create day voting phase indicator'
      tools:
      - createPhaseIndicator
    - description: 'TIER 2 - GROUP: Create voting panel for all eligible voters (alive
        players)'
      tools:
      - createVotingPanel
    - description: 'TIER 2 - GROUP: Show reminder to eliminated players that they
        cannot vote'
      tools:
      - createTextDisplay
    completion_criteria:
      type: player_action
      description: All eligible voters have cast their votes and relevant player state
        (player_states) has been updated with voting selections.
      wait_for: multiple_players_action
      target_players:
        description: All eligible voters (alive players with voting rights)
        condition: player.can_vote == true and player.is_alive == true
    next_phase:
      id: 16
      name: Announce Day Voting Results
  16:
    name: Announce Day Voting Results
    description: Announce the player selected for elimination by day vote and update
      their status.
    actions:
    - description: Clear voting UI; exempt death markers so prior eliminations remain
        visible
      tools:
      - clearCanvas
    - description: 'TIER 1 - PUBLIC: Create results display with the eliminated player''s
        name'
      tools:
      - createResultDisplay
    - description: 'TIER 1 - PUBLIC: Mark the eliminated player dead and create a
        public death marker'
      tools:
      - markPlayerDead
      - createDeathMarker
    completion_criteria:
      type: UI_displayed
      description: Day voting results have been announced and the eliminated player's
        status has been updated.
    next_phase:
      id: 9
      name: Check Win Conditions
  99:
    name: Game Over — Final Results
    description: Display the final outcome based on win conditions and close the game.
    actions:
    - description: Clear all non-persistent UI; exempt death markers so final state
        remains visible
      tools:
      - clearCanvas
    - description: 'TIER 1 - PUBLIC: Create final results phase indicator'
      tools:
      - createPhaseIndicator
    - description: 'TIER 1 - PUBLIC: Display the winning side and a summary of endgame
        status'
      tools:
      - createResultDisplay
    completion_criteria:
      type: UI_displayed
      description: Final results have been displayed.
    next_phase: null

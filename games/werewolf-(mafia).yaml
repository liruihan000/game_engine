declaration:
  description: 'Social deduction game with secret night actions. Night resolves in
    strict order: kill attempt → protection check → investigation. Morning reveals
    results to all. Game flow state graph: role_assignment → first_night → first_morning
    → first_day_discussion → first_day_voting → (night → morning → day_discussion
    → day_voting) cycle until win conditions met → game_over. Win conditions: werewolves
    win when they equal or outnumber villagers; village wins when all werewolves are
    eliminated.'
  is_multiplayer: true
  min_players: 4
  roles:
  - name: Villager
    description: Has no special abilities; votes during the day.
  - name: Werewolf
    description: At night, secretly selects a target to eliminate.
  - name: Doctor
    description: At night, secretly selects one player to protect from elimination.
  - name: Detective
    description: At night, secretly investigates one player to learn their team.
  player_states:
    name:
      type: string
      example: Player A
      description: Public display name.
    role:
      type: string
      example: Werewolf
      description: Secret identity (e.g., Villager, Werewolf, Doctor, Detective).
    team:
      type: string
      example: werewolves
      description: Faction alignment used for targeting and win checks (e.g., 'villagers',
        'werewolves').
    is_alive:
      type: boolean
      example: true
      description: Whether the player remains in the game. Controls participation
        and visibility.
    role_revealed:
      type: boolean
      example: false
      description: Whether this player's role has been publicly revealed.
    can_vote:
      type: boolean
      example: true
      description: Eligibility to vote during day phases.
    can_act_night:
      type: boolean
      example: true
      description: Eligibility to perform a night action (werewolves, doctor, detective
        when alive). Controls night UI visibility.
    night_action_target_id:
      type: num
      example: 0
      description: Selected target player ID for the current night (0 means no target).
    protected_tonight:
      type: boolean
      example: false
      description: Flag set if the doctor protected this player during the current
        night.
    pending_elimination:
      type: boolean
      example: false
      description: Flag indicating the player is marked for elimination pending resolution
        and morning reveal.
    investigation_results:
      type: dict
      example: {}
      description: 'Private knowledge map for detectives: {player_id: revealed_team}.'
  player_states_template:
    player_states:
      1:
        name: ''
        role: ''
        team: ''
        is_alive: true
        role_revealed: false
        can_vote: true
        can_act_night: false
        night_action_target_id: 0
        protected_tonight: false
        pending_elimination: false
        investigation_results: {}
  players_example:
    player_states:
      1:
        name: Lupin
        role: Werewolf
        team: werewolves
        is_alive: true
        role_revealed: false
        can_vote: true
        can_act_night: true
        night_action_target_id: 0
        protected_tonight: false
        pending_elimination: false
        investigation_results: {}
      2:
        name: Vera
        role: Villager
        team: villagers
        is_alive: true
        role_revealed: false
        can_vote: true
        can_act_night: false
        night_action_target_id: 0
        protected_tonight: false
        pending_elimination: false
        investigation_results: {}
      3:
        name: Doc
        role: Doctor
        team: villagers
        is_alive: true
        role_revealed: false
        can_vote: true
        can_act_night: true
        night_action_target_id: 0
        protected_tonight: false
        pending_elimination: false
        investigation_results: {}
      4:
        name: Sher
        role: Detective
        team: villagers
        is_alive: true
        role_revealed: false
        can_vote: true
        can_act_night: true
        night_action_target_id: 0
        protected_tonight: false
        pending_elimination: false
        investigation_results: {}
  audience_groups:
    werewolves:
      description: All alive players aligned with the werewolf faction.
      selection_criteria: player.team == 'werewolves' and player.is_alive == true
    villagers:
      description: All alive players aligned with the villager faction.
      selection_criteria: player.team == 'villagers' and player.is_alive == true
    alive_players:
      description: All players who are still in the game.
      selection_criteria: player.is_alive == true
    dead_players:
      description: All players who have been eliminated.
      selection_criteria: player.is_alive == false
    night_actors:
      description: Alive players eligible for night actions (werewolves, doctor, detective).
      selection_criteria: player.can_act_night == true and player.is_alive == true
    voters:
      description: Alive players eligible to vote during day phases.
      selection_criteria: player.can_vote == true and player.is_alive == true
    doctor_only:
      description: The living doctor for private protection UI.
      selection_criteria: player.role == 'Doctor' and player.is_alive == true
    detective_only:
      description: The living detective for private investigation UI and knowledge.
      selection_criteria: player.role == 'Detective' and player.is_alive == true
phases:
  0:
    name: Game Introduction
    description: Introduce the game rules, objectives, roles, and overall day/night
      flow to all players.
    actions:
    - description: Clear previous UI to prepare for introduction
      tools:
      - clearCanvas
    - description: 'TIER 1 - PUBLIC: Show phase indicator for introduction and setup'
      tools:
      - createPhaseIndicator
    - description: 'TIER 1 - PUBLIC: Display rules, night order (kill → protect →
        investigate), day flow, and win conditions'
      tools:
      - createTextDisplay
    - description: 'TIER 1 - PUBLIC: Show player list and configuration overview'
      tools:
      - createTextDisplay
    completion_criteria:
      type: UI_displayed
      description: Game introduction has been displayed to all players.
    next_phase:
      id: 1
      name: Role Assignment
  1:
    name: Role Assignment
    description: Randomly assign roles to players and privately display each player's
      role using strict audience permissions.
    actions:
    - description: Clear UI and prepare for private role reveals
      tools:
      - clearCanvas
    - description: 'TIER 1 - PUBLIC: Create phase indicator and general announcement
        about random, secret role assignment'
      tools:
      - createPhaseIndicator
      - createTextDisplay
    - description: 'TIER 3 - INDIVIDUAL: Display individual secret role cards to each
        player (private per player screen)'
      tools:
      - createCharacterCard
    - description: 'TIER 1 - PUBLIC: Brief next steps: first night sequence and privacy
        reminders'
      tools:
      - createTextDisplay
    completion_criteria:
      type: UI_displayed
      description: Role cards have been created with proper audience permissions -
        each player can see only their own role.
    next_phase:
      id: 2
      name: Night — Werewolves Choose Target
  2:
    name: Night — Werewolves Choose Target
    description: Werewolves secretly select a player to eliminate; each werewolf sets
      their night_action_target_id. Non-werewolves see a waiting message.
    actions:
    - description: Clear canvas and set night context
      tools:
      - clearCanvas
    - description: 'TIER 1 - PUBLIC: Show night phase indicator and general night
        instructions'
      tools:
      - createPhaseIndicator
    - description: 'TIER 2 - GROUP: Provide coordination/warning text for werewolves
        only'
      tools:
      - createTextDisplay
    - description: 'TIER 2 - GROUP: Create werewolves-only voting panel to choose
        a target (alive players list)'
      tools:
      - createVotingPanel
    completion_criteria:
      type: player_action
      description: Votes/selection received from all living werewolves via voting
        panel, and relevant player state (night_action_target_id) has been updated.
      wait_for: all_players_action
      target_players:
        description: All living werewolves
        condition: player.team == 'werewolves' and player.is_alive == true
    next_phase:
      id: 3
      name: Night — Doctor Protects
  3:
    name: Night — Doctor Protects
    description: Doctor secretly selects one player to protect; sets protected_tonight
      for the chosen player.
    actions:
    - description: Clear werewolf UI and update night indicator
      tools:
      - clearCanvas
    - description: 'TIER 1 - PUBLIC: Show night continues indicator and public waiting
        message'
      tools:
      - createPhaseIndicator
      - createTextDisplay
    - description: 'TIER 3 - INDIVIDUAL: Doctor-only instructions and reminder they
        may self-protect depending on house rules'
      tools:
      - createTextDisplay
    - description: 'TIER 3 - INDIVIDUAL: Create doctor-only voting panel to choose
        a player to protect'
      tools:
      - createVotingPanel
    completion_criteria:
      type: player_action
      description: Doctor has selected a protection target via voting panel, and relevant
        player state (protected_tonight) has been updated.
      wait_for: single_player_choice
      target_players:
        description: The living Doctor
        condition: player.role == 'Doctor' and player.is_alive == true
    next_phase:
      id: 4
      name: Night — Detective Investigates
  4:
    name: Night — Detective Investigates
    description: Detective secretly selects a player to investigate; investigation_results
      for the Detective are updated with the target’s team.
    actions:
    - description: Clear doctor UI and maintain night context
      tools:
      - clearCanvas
    - description: 'TIER 1 - PUBLIC: Show night indicator and public waiting message'
      tools:
      - createPhaseIndicator
      - createTextDisplay
    - description: 'TIER 3 - INDIVIDUAL: Detective-only instructions describing investigation
        outcome visibility'
      tools:
      - createTextDisplay
    - description: 'TIER 3 - INDIVIDUAL: Create detective-only voting panel to choose
        a player to investigate'
      tools:
      - createVotingPanel
    completion_criteria:
      type: player_action
      description: Detective has selected a player via voting panel, and relevant
        player state (investigation_results) has been updated.
      wait_for: single_player_choice
      target_players:
        description: The living Detective
        condition: player.role == 'Detective' and player.is_alive == true
    next_phase:
      id: 5
      name: Night Resolution & Private Results
  5:
    name: Night Resolution & Private Results
    description: Resolve kill vs. protection, set pending_elimination accordingly,
      and privately deliver investigation result to the Detective.
    actions:
    - description: Clear night action UIs and display resolution status
      tools:
      - clearCanvas
    - description: 'TIER 1 - PUBLIC: Show night resolution indicator and general status
        update'
      tools:
      - createPhaseIndicator
      - createTextDisplay
    - description: 'TIER 3 - INDIVIDUAL: Show detective-only investigation outcome
        (target’s team) privately'
      tools:
      - createTextDisplay
    completion_criteria:
      type: UI_displayed
      description: Night outcomes determined; pending_elimination/protection resolved
        and detective has received private result.
    next_phase:
      id: 6
      name: Morning Reveal
  6:
    name: Morning Reveal
    description: Announce night results publicly; eliminate any player with pending_elimination
      not protected and update visibility.
    actions:
    - description: Clear resolution UI and set morning context
      tools:
      - clearCanvas
    - description: 'TIER 1 - PUBLIC: Show morning phase indicator and reveal summary'
      tools:
      - createPhaseIndicator
      - createResultDisplay
    - description: 'TIER 1 - PUBLIC: Mark eliminated player(s) as dead (if any) and
        reveal as appropriate'
      tools:
      - markPlayerDead
    completion_criteria:
      type: UI_displayed
      description: Morning results have been publicly revealed.
    next_phase:
      id: 7
      name: Day Discussion
  7:
    name: Day Discussion
    description: Open discussion among all living players; prepare for daytime accusation
      and voting.
    actions:
    - description: Clear morning reveal UI and start discussion period
      tools:
      - clearCanvas
    - description: 'TIER 1 - PUBLIC: Show day discussion indicator and timer'
      tools:
      - createPhaseIndicator
      - createTimer
    - description: 'TIER 1 - PUBLIC: Display discussion guidance and reminder of voting
        phase next'
      tools:
      - createTextDisplay
    completion_criteria:
      type: timer
      description: Discussion timer has expired.
    next_phase:
      id: 8
      name: Day Voting
  8:
    name: Day Voting
    description: All eligible, living players vote to eliminate a suspect.
    actions:
    - description: Clear discussion UI and set voting context
      tools:
      - clearCanvas
    - description: 'TIER 1 - PUBLIC: Show day voting indicator and instructions'
      tools:
      - createPhaseIndicator
      - createTextDisplay
    - description: 'TIER 2 - GROUP: Create voting panel visible only to living voters
        (eligible players)'
      tools:
      - createVotingPanel
    - description: 'TIER 2 - GROUP: Notify dead players they cannot vote'
      tools:
      - createTextDisplay
    completion_criteria:
      type: player_action
      description: Votes have been received from all eligible living voters via voting
        panel, and relevant player state has been updated.
      wait_for: all_players_action
      target_players:
        description: All eligible, living voters
        condition: player.can_vote == true and player.is_alive == true
    next_phase:
      id: 9
      name: Announce Voting Results
  9:
    name: Announce Voting Results
    description: Reveal the player chosen by vote and apply elimination.
    actions:
    - description: Clear voting UI and present results
      tools:
      - clearCanvas
    - description: 'TIER 1 - PUBLIC: Display voting result announcement'
      tools:
      - createPhaseIndicator
      - createResultDisplay
    - description: 'TIER 1 - PUBLIC: Eliminate selected player and reveal as needed'
      tools:
      - markPlayerDead
    completion_criteria:
      type: UI_displayed
      description: Voting results have been announced and any elimination applied.
    next_phase:
      id: 10
      name: Check Win Conditions
  10:
    name: Check Win Conditions
    description: Evaluate whether either side has already won; otherwise continue
      the night/day cycle.
    actions:
    - description: 'TIER 1 - PUBLIC: Show status check and internally evaluate living
        werewolves vs villagers (including special roles)'
      tools:
      - clearCanvas
      - createTextDisplay
    completion_criteria:
      type: UI_displayed
      description: Win condition evaluation finished; state prepared for routing.
    next_phase:
      If no living Werewolves remain (all eliminated):
        id: 99
        name: Game Over — Village Wins
      If living Werewolves are equal to or outnumber living Villagers:
        id: 99
        name: Game Over — Werewolves Win
      Otherwise, continue with next night:
        id: 2
        name: Night — Werewolves Choose Target
  99:
    name: Game Over
    description: Display final outcome and end the game.
    actions:
    - description: Clear UI and present final results
      tools:
      - clearCanvas
    - description: 'TIER 1 - PUBLIC: Show game over indicator and winning side'
      tools:
      - createPhaseIndicator
      - createResultDisplay
    completion_criteria:
      type: UI_displayed
      description: Final results displayed to all players.
    next_phase: null

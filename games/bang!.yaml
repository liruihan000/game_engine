declaration:
  description: 'A Wild West hidden-role shootout card game. The Sheriff (revealed)
    must eliminate Outlaws and the Renegade; Deputies protect the Sheriff; Outlaws
    try to kill the Sheriff; the Renegade aims to be the last player alive. Players
    sit in a circle and distance/range restrict who can be targeted. Each turn: draw
    2 cards, play cards, resolve reactions (e.g., Bang!/Missed!, Indians!, Duel),
    then discard to hand limit and check eliminations and win conditions. Game flow:
    game_setup -> role_assignment -> character_assignment -> initial_setup -> turn_start
    -> draw_phase -> play_phase -> reaction windows -> damage_resolution -> discard_phase
    -> elimination_check -> win_check -> next turn or game_over.'
  is_multiplayer: true
  roles:
  - name: Sheriff
    description: Revealed at start; maximum health +1; wins if all Outlaws and the
      Renegade are eliminated.
  - name: Deputy
    description: Hidden role; protects the Sheriff; wins when the Sheriff wins.
  - name: Outlaw
    description: Hidden role; wins immediately when the Sheriff is eliminated (even
      if the Outlaw is eliminated earlier).
  - name: Renegade
    description: Hidden role; wins if they are the last player alive.
  player_states:
    name:
      type: string
      example: Player A
      description: Display name for UI, logs, and announcements.
    role:
      type: string
      example: Sheriff
      description: 'Hidden role identity: Sheriff, Deputy, Outlaw, or Renegade.'
    is_role_revealed:
      type: boolean
      example: true
      description: Whether this player's role is currently public. The Sheriff starts
        revealed; others reveal upon elimination or specific effects.
    character:
      type: string
      example: Rose Doolan
      description: Chosen character with a unique passive or active ability that modifies
        core rules.
    character_ability:
      type: string
      example: Sees all other players at distance -1 (minimum 1).
      description: Short rules text for the character's unique ability to aid rules
        processing and UI.
    is_alive:
      type: boolean
      example: true
      description: True if the player is still in the game; false if eliminated.
    health:
      type: num
      example: 4
      description: Current health (bullets). Damage reduces this; Beer and some effects
        can heal up to max_health.
    max_health:
      type: num
      example: 4
      description: Maximum health. The Sheriff usually starts with +1 max health.
    hand:
      type: array
      example:
      - Bang!
      - Missed!
      - Beer
      description: Cards in hand. Typical cards include Bang!, Missed!, Beer, Panic!,
        Cat Balou, Duel, Indians!, Gatling, and others.
    equipment:
      type: dict
      example:
        weapon: Schofield
        other:
        - Mustang
        - Barrel
      description: 'Equipped/in-play cards. weapon: current gun (e.g., Volcanic=1,
        Schofield=2, Remington=3, Carabine=4, Winchester=5). other: list of non-weapon
        blue cards such as Mustang (+1 distance to you), Scope (-1 distance to others),
        Barrel (defense), Jail, Dynamite.'
    weapon_range:
      type: num
      example: 1
      description: Range value of the currently equipped weapon (default 1 if no weapon).
        Determines the base target distance you can reach with Bang!.
    range_bonus:
      type: num
      example: 0
      description: Net modifier that reduces effective distance to others (e.g., Scope,
        character abilities). Increases how far you can target.
    distance_bonus:
      type: num
      example: 0
      description: Net modifier that increases the distance others perceive to you
        (e.g., Mustang, Paul Regret). Makes you harder to target.
    seat_index:
      type: num
      example: 0
      description: Seat order index in the circle (0-based). Distances are measured
        by shortest path around the circle.
    bangs_played_this_turn:
      type: num
      example: 0
      description: Count of Bang! cards played this turn (normally limited to 1 unless
        modified by Volcanic or abilities).
    hand_limit_modifier:
      type: num
      example: 0
      description: Modifier to end-of-turn hand size limit (base hand limit equals
        current health).
  players_example:
    players:
      1:
        name: Sheriff Sam
        role: Sheriff
        is_role_revealed: true
        character: Rose Doolan
        character_ability: Sees other players at distance -1 (minimum 1).
        is_alive: true
        health: 5
        max_health: 5
        hand:
        - Bang!
        - Missed!
        - Beer
        equipment:
          weapon: Schofield
          other:
          - Scope
        weapon_range: 2
        range_bonus: 1
        distance_bonus: 0
        seat_index: 0
        bangs_played_this_turn: 0
        hand_limit_modifier: 0
      2:
        name: Lily
        role: Outlaw
        is_role_revealed: false
        character: Jesse Jones
        character_ability: At draw phase, may draw the first card from another player's
          hand instead of the deck (range 1).
        is_alive: true
        health: 4
        max_health: 4
        hand:
        - Missed!
        - Panic!
        - Bang!
        equipment:
          weapon: Volcanic
          other: []
        weapon_range: 1
        range_bonus: 0
        distance_bonus: 0
        seat_index: 1
        bangs_played_this_turn: 0
        hand_limit_modifier: 0
      3:
        name: Buck
        role: Deputy
        is_role_revealed: false
        character: Paul Regret
        character_ability: All other players see you at +1 distance.
        is_alive: true
        health: 4
        max_health: 4
        hand:
        - Beer
        - Bang!
        equipment:
          weapon: Remington
          other:
          - Mustang
        weapon_range: 3
        range_bonus: 0
        distance_bonus: 1
        seat_index: 2
        bangs_played_this_turn: 0
        hand_limit_modifier: 0
      4:
        name: Doc
        role: Renegade
        is_role_revealed: false
        character: Calamity Janet
        character_ability: You may use Bang! as Missed! and Missed! as Bang!.
        is_alive: true
        health: 4
        max_health: 4
        hand:
        - Duel
        - Missed!
        - Bang!
        equipment:
          weapon: Colt .45
          other:
          - Barrel
        weapon_range: 1
        range_bonus: 0
        distance_bonus: 0
        seat_index: 3
        bangs_played_this_turn: 0
        hand_limit_modifier: 0
phases:
  0:
    name: Game Introduction
    description: Introduce the Wild West hidden-role shootout card game rules, objectives,
      setup, and turn structure to all players.
    actions:
    - description: Clear any previous UI and prepare the introduction screen
      tools:
      - clear_phase_ui
    - description: Display game rules, roles, objectives, and turn sequence overview
      tools:
      - display_game_intro
    - description: Show player list and initial game configuration
      tools:
      - display_player_setup
    completion_criteria:
      type: UI_displayed
      description: Game introduction has been displayed to all players.
    next_phase:
      id: 1
      name: Role Assignment
  1:
    name: Role Assignment
    description: Randomly assign hidden roles (Sheriff, Deputy, Outlaw, Renegade)
      to players and notify them privately.
    actions:
    - description: Clear previous UI and prepare role assignment
      tools:
      - clear_phase_ui
    - description: Randomly assign all roles to players according to player count
        and game setup
      tools:
      - assign_roles_randomly
    - description: Privately notify each player of their hidden role
      tools:
      - notify_player_roles
    completion_criteria:
      type: UI_displayed
      description: All roles have been assigned and players have been notified.
    next_phase:
      id: 2
      name: Character Assignment
  2:
    name: Character Assignment
    description: Randomly assign each player a character with a unique ability, and
      record ability text for rules processing.
    actions:
    - description: Clear previous UI and prepare character assignment
      tools:
      - clear_phase_ui
    - description: Randomly assign characters to all players and set their character
        abilities
      tools:
      - assign_characters_randomly
    - description: Notify players of their character and ability
      tools:
      - notify_player_characters
    completion_criteria:
      type: UI_displayed
      description: All characters have been assigned and communicated.
    next_phase:
      id: 3
      name: Initial Setup
  3:
    name: Initial Setup
    description: 'Finalize setup: determine seating, set initial health/max health,
      reveal Sheriff, apply Sheriff bonus, equip base weapons, and deal starting hands.'
    actions:
    - description: Clear previous UI and prepare initial setup
      tools:
      - clear_phase_ui
    - description: Assign seat order and display the seating circle
      tools:
      - assign_seat_order
    - description: Set initial max health and current health per character; apply
        Sheriff +1 max health and reveal Sheriff
      tools:
      - initialize_health_and_reveal_sheriff
    - description: Equip Colt .45 (or default weapon) and place initial equipment
        as needed
      tools:
      - equip_base_weapons
    - description: Deal starting cards to each player and display starting state
      tools:
      - deal_starting_hands_and_display_state
    completion_criteria:
      type: UI_displayed
      description: Initial setup is complete and visible to all players.
    next_phase:
      id: 4
      name: Turn Start
  4:
    name: Turn Start
    description: 'Begin the active player''s turn: announce active player, reset per-turn
      counters, and resolve start-of-turn effects (e.g., Jail, Dynamite).'
    actions:
    - description: Clear previous UI and prepare turn start display
      tools:
      - clear_phase_ui
    - description: Announce the active player and highlight their board area
      tools:
      - announce_active_player
    - description: Reset per-turn counters such as bangs_played_this_turn
      tools:
      - reset_turn_counters
    - description: Resolve start-of-turn statuses (e.g., flip/top-deck checks for
        Jail/Dynamite) and apply outcomes
      tools:
      - resolve_start_of_turn_effects
    completion_criteria:
      type: UI_displayed
      description: Start-of-turn housekeeping completed and active player highlighted.
    next_phase:
      id: 5
      name: Draw Phase
  5:
    name: Draw Phase
    description: Active player draws 2 cards or uses character/card effects that modify
      drawing (e.g., Jesse Jones).
    actions:
    - description: Clear previous UI and present draw options
      tools:
      - clear_phase_ui
    - description: Display draw choices to the active player (deck vs permitted targets)
        and process the draw selection(s)
      tools:
      - prompt_draw_choices
      - draw_cards_and_update_state
    completion_criteria:
      type: player_action
      description: Active player's draw decisions have been received and processed,
        and relevant player state (player_states) has been updated.
      wait_for: single_player_choice
      target_players:
        description: Active player taking the draw step
        condition: player.seat_index == turn.active_index and player.is_alive == true
    next_phase:
      id: 6
      name: Play Action Step
  6:
    name: Play Action Step
    description: 'Active player performs a single action: play one card (resolving
      its immediate effects or opening reactions) or pass.'
    actions:
    - description: Clear previous UI and open the play interface for the active player
      tools:
      - clear_phase_ui
    - description: Allow the active player to play one card or pass; update last_played_card,
        pending reaction flags, and counters
      tools:
      - open_play_interface
      - enable_card_play_or_pass
      - update_play_state
    completion_criteria:
      type: player_action
      description: Active player's next action (play one card or pass) has been received,
        and relevant player state (player_states) has been updated.
      wait_for: single_player_choice
      target_players:
        description: Active player for this turn
        condition: player.seat_index == turn.active_index and player.is_alive == true
    next_phase:
      If the active player chose to pass (no card played):
        id: 12
        name: Discard Phase
      If the played card requires a reaction window (e.g., Bang!, Duel, Indians!, Gatling):
        id: 14
        name: Reaction Routing
      If the played card resolves immediately with no reactions needed:
        id: 9
        name: Resolve Card Effects and Damage
  7:
    name: Single-Target Reaction Response
    description: Prompt the targeted player (or current Duel responder) to respond
      (e.g., Missed!, Bang! in Duel) and update the reaction state.
    actions:
    - description: Clear previous UI and present the reaction prompt to the current
        responder
      tools:
      - clear_phase_ui
    - description: Capture the responder's choice and update the reaction context
      tools:
      - prompt_single_reaction
      - update_reaction_state
    completion_criteria:
      type: player_action
      description: Current responder's reaction has been received, and relevant player
        state (player_states) has been updated.
      wait_for: single_player_choice
      target_players:
        description: Currently targeted player or the player who must respond next
          in the Duel
        condition: player.id == reaction.current_responder_id and player.is_alive
          == true
    next_phase:
      If the response continues the exchange (e.g., Duel passes to the other player):
        id: 7
        name: Single-Target Reaction Response
      If the response cancels or avoids the effect (no damage to apply):
        id: 9
        name: Resolve Card Effects and Damage
      If no valid response is provided or the effect proceeds to damage:
        id: 9
        name: Resolve Card Effects and Damage
  8:
    name: Group Reaction Responses
    description: Collect reactions from all affected players for group effects (e.g.,
      Indians!, Gatling) and update the reaction state.
    actions:
    - description: Clear previous UI and display reaction UI to all affected players
      tools:
      - clear_phase_ui
    - description: Collect reactions from all affected players and update the reaction
        context
      tools:
      - create_group_reaction_ui
      - collect_and_update_group_reactions
    completion_criteria:
      type: player_action
      description: Reactions from all affected players have been received, and relevant
        player state (player_states) has been updated.
      wait_for: all_players_action
      target_players:
        description: All affected surviving players
        condition: player.is_alive == true and player.id in reaction.affected_player_ids
    next_phase:
      id: 9
      name: Resolve Card Effects and Damage
  9:
    name: Resolve Card Effects and Damage
    description: Apply the effects of the last played card, considering reactions;
      adjust hands, equipment, and health; determine eliminations.
    actions:
    - description: Clear previous UI and prepare to resolve effects and damage
      tools:
      - clear_phase_ui
    - description: Apply card effects (steal/discard/equip/heal) and compute damage
        after reactions
      tools:
      - apply_card_effects_and_damage
    - description: Check for players reduced to 0 or less health and mark pending
        eliminations
      tools:
      - check_pending_eliminations
      - update_ui_log
    completion_criteria:
      type: UI_displayed
      description: Effects and damage have been resolved; state has been updated.
    next_phase:
      If any players were eliminated during resolution:
        id: 10
        name: Elimination Processing
      If no eliminations occurred:
        id: 6
        name: Play Action Step
  10:
    name: Elimination Processing
    description: 'Process each eliminated player: reveal role, drop/transfer cards
      per rules, award any rewards, and finalize removal from play.'
    actions:
    - description: Clear previous UI and prepare elimination processing
      tools:
      - clear_phase_ui
    - description: Reveal eliminated players' roles, handle card drops/transfers,
        and apply reward/penalty effects
      tools:
      - process_eliminations_and_rewards
    - description: Set is_alive to false, set is_role_revealed to true, and display
        elimination summary
      tools:
      - update_player_elimination_state
      - display_elimination_results
    completion_criteria:
      type: UI_displayed
      description: All eliminations processed and displayed.
    next_phase:
      id: 11
      name: Check Win Conditions
  11:
    name: Check Win Conditions
    description: Evaluate whether Outlaws, Sheriff team, or Renegade have won; otherwise
      continue the appropriate flow.
    actions:
    - description: Clear previous UI and evaluate current win state
      tools:
      - clear_phase_ui
    - description: Compute counts and special conditions (e.g., Sheriff eliminated
        triggers Outlaw win)
      tools:
      - evaluate_win_conditions
    completion_criteria:
      type: UI_displayed
      description: Win condition evaluation finished; state prepared for routing.
    next_phase:
      If the Sheriff has been eliminated (Outlaws win immediately):
        id: 99
        name: Game Over — Outlaws Win
      If all Outlaws and the Renegade have been eliminated (Sheriff team wins):
        id: 99
        name: Game Over — Sheriff Team Wins
      If only the Renegade remains alive (Renegade wins):
        id: 99
        name: Game Over — Renegade Wins
      If no side has won and this check occurred mid-turn after a card play:
        id: 6
        name: Play Action Step
      If no side has won and this check occurred at end of turn (after discards):
        id: 13
        name: Next Turn Transition
  12:
    name: Discard Phase
    description: Active player discards down to their hand limit (equal to current
      health, modified by effects).
    actions:
    - description: Clear previous UI and present discard-to-limit interface
      tools:
      - clear_phase_ui
    - description: Allow the active player to select discards until hand size meets
        limit; update piles and counters
      tools:
      - prompt_discard_to_limit
      - apply_discards_and_update_state
    completion_criteria:
      type: player_action
      description: Active player's discard selections have been received, and relevant
        player state (player_states) has been updated.
      wait_for: single_player_choice
      target_players:
        description: Active player finishing their turn
        condition: player.seat_index == turn.active_index and player.is_alive == true
    next_phase:
      id: 11
      name: Check Win Conditions
  13:
    name: Next Turn Transition
    description: Advance to the next living player in seating order and prepare for
      their turn.
    actions:
    - description: Clear previous UI and advance the turn order to the next alive
        player
      tools:
      - clear_phase_ui
      - advance_turn_order
    - description: Reset per-turn counters for the new active player and display turn
        banner
      tools:
      - reset_turn_counters
      - display_turn_transition
    completion_criteria:
      type: UI_displayed
      description: Active player advanced and turn transition displayed.
    next_phase:
      id: 4
      name: Turn Start
  14:
    name: Reaction Routing
    description: Determine whether the last played card requires single-target or
      group reactions and set the reaction context.
    actions:
    - description: Clear previous UI and analyze the last played card to set reaction
        context (affected players, order, type)
      tools:
      - clear_phase_ui
      - set_reaction_context
    completion_criteria:
      type: UI_displayed
      description: Reaction context has been set and is ready for the appropriate
        reaction phase.
    next_phase:
      If the last played card requires a single-target reaction or an ongoing Duel exchange:
        id: 7
        name: Single-Target Reaction Response
      If the last played card requires reactions from multiple affected players:
        id: 8
        name: Group Reaction Responses
      If analysis shows no reactions are required:
        id: 9
        name: Resolve Card Effects and Damage
  99:
    name: Game Over
    description: Display the winning side, reveal all roles and characters, and present
      the final board state.
    actions:
    - description: Clear previous UI and display endgame summary
      tools:
      - clear_phase_ui
    - description: Reveal all roles and characters; show the winners and final board
        state
      tools:
      - display_game_over_summary
    completion_criteria:
      type: UI_displayed
      description: Game over screen has been displayed and the game is concluded.
    next_phase: null
